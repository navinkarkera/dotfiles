#!/usr/bin/env bash

command=$1
path=$2
result=$3
start=$4
end=$5
output=$6
job_id=$7
group=$8
took=$(bc <<< "$end - $start")
msg="[$result]: '$command'; Took: $took seconds"
notify-send -a "Task queue: $group" "$msg" "$(echo -e "$output")"
priority="default"
tag="information_source"
topic="nrk_mangalpete_$(hostname)"
[[ $result != "Success" ]]  && priority="high" && tag="warning";
(( $took > 5 )) && curl -H "Title: [$took seconds]$command" -H "Priority: $priority" -H "Tags: $tag" -d "$(echo -e "$output")" ntfy.sh/$topic
